<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Grag</title>
<script src="/jslib/jquery-2.1.3.js"></script>
<script src="/jslib/jquery-ui.js"></script>
<link rel="stylesheet" href="/jslib/jquery-ui.css">
<script src="/socket.io/socket.io.js"></script>
<script src="/jslib/jquery.toast.min.js"></script> <!-- source: https://github.com/kamranahmedse/jquery-toast-plugin -->  
<link rel="stylesheet" href="/jslib/jquery.toast.min.css">
<style>
// https://www.w3schools.com/howto/howto_js_rangeslider.asp

.volume {
  width: 100%; /* Width of the outside container */
}

/* The slider itself */
.slider {
  -webkit-appearance: none;  /* Override default CSS styles */
  appearance: none;
  width: 100%; /* Full-width */
  height: 25px; /* Specified height */
  background: #d3d3d3; /* Grey background */
  outline: none; /* Remove outline */
  opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
  -webkit-transition: .2s; /* 0.2 seconds transition on hover */
  transition: opacity .2s;
}

/* Mouse-over effects */
.slider:hover {
  opacity: 1; /* Fully shown on mouse-over */
}

/* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */
.slider::-webkit-slider-thumb {
  -webkit-appearance: none; /* Override default look */
  appearance: none;
  width: 25px; /* Set a specific slider handle width */
  height: 25px; /* Slider handle height */
  background: #4CAF50; /* Green background */
  cursor: pointer; /* Cursor on hover */
}

.slider::-moz-range-thumb {
  width: 25px; /* Set a specific slider handle width */
  height: 25px; /* Slider handle height */
  background: #4CAF50; /* Green background */
  cursor: pointer; /* Cursor on hover */
}
</style>

<script>
var spanResult

var socket = io.connect('/browser')
var clientId = undefined
var state = {}, oldState = {}
var mpd = {}, mpd2 = {}

let onChange_colorChange = (htmlId) => (stateId, oldState, newState) => { document.getElementById(htmlId).style.color = (newState == 'ON' ? 'red' : '') }
let cmdToggle = (urlOn, urlOff) => (stateId, state) => cmd(state == 'OFF' ? urlOn : urlOff)
let onChange_blinds = (htmlId, fgetState) => (stateId, oldState, newState) => { document.getElementById(htmlId).style.color = (fgetState() ? 'red' : '') }
let fAndState = (stateId1, stateId2) => () => (state[stateId1] == 'ON' || state[stateId2] == 'ON')
var mappings = {
	'plug1': { onChange: onChange_colorChange('titleAlarm'), onCmdToggle: cmdToggle('/plug1/on', '/plug1/off') },
	'hoard-light': { onChange: onChange_colorChange('titleHoardLight'), onCmdToggle: cmdToggle('/hoard-light/on', '/hoard-light/off') },
	'hoard-fan': { onChange: onChange_colorChange('titleHoardFan'), onCmdToggle: cmdToggle('/hoard-fan/on', '/hoard-fan/off') },
	'blinds1a': { onChange: onChange_blinds('titleBlinds1', fAndState('blinds1a', 'blinds1b')) },
	'blinds1b': { onChange: onChange_blinds('titleBlinds1', fAndState('blinds1a', 'blinds1b')) },
	'mpd': { onChange: onChange_colorChange('titleMpd'), onCmdToggle: cmdToggle('/mpd/fadePlay', '/mpd/fadePause') },
	'mpd2': { onChange: onChange_colorChange('titleMpd2'), onCmdToggle: cmdToggle('/mpd2/fadePlay', '/mpd2/fadePause') },
}

</script>

<script src="smart.js"></script>


<script>


function updateMpdStatus(status) {
	console.log(status)
	document.getElementById("mpdVolume").value = status.volume
	document.getElementById("mpdState").textContent = status.state
	document.getElementById("mpdTitle").textContent = status.Title
	document.getElementById("mpdName").textContent = status.Name
	let oldState = state['mpd']
	state['mpd'] = status.state == 'play' ? 'ON' : 'OFF'
	updatePage('mpd', oldState, state['mpd'])
}

function updateMpd2Status(status) {
	console.log(status)
	document.getElementById("mpd2Volume").value = status.volume
	document.getElementById("mpd2State").textContent = status.state
	document.getElementById("mpd2Title").textContent = status.Title
	document.getElementById("mpd2Name").textContent = status.Name
	let oldState = state['mpd2']
	state['mpd2'] = status.state == 'play' ? 'ON' : 'OFF'
	updatePage('mpd2', oldState, state['mpd2'])
}

function onload() {
	spanResult = document.getElementById('result')
	
	document.getElementById("mpdVolume").oninput = function() {
		console.log("MPD volume slider changed to: " + this.value)
		socket.emit('mpd1-setVolume', this.value)
	}

	document.getElementById("mpd2Volume").oninput = function() {
		console.log("MPD2 volume slider changed to: " + this.value)
		socket.emit('mpd2-setVolume', this.value)
	}
	
}



function toggleHide(id, scrollIntoViewElement = null) {
	let element = document.getElementById(id)
	element.style.display = element.style.display == 'none' ? 'block' : 'none'
	if (scrollIntoViewElement) {
		let element2 = document.getElementById(scrollIntoViewElement)
		element2.scrollIntoView()
	}
}

</script>
</head>
<body onload="onload()">

<h1 id="title"><center><span onclick="location.href='grag2.html'">Grag</span> zu Diensten</center></h1>

<h2 id="titleMpd2" onclick="toggle('mpd2')">MPD Hoard</h2>
<div id="mpd2">
<span id="mpd2Status">
<b>State:</b> <span id="mpd2State"></span><br>
<b>Title:</b> <span id="mpd2Title"></span><br>
<b>Name:</b> <span id="mpd2Name"></span><br>
<div class="volume"><input type="range" min="1" max="100" value="50" class="slider" id="mpd2Volume"></div>
</span><br>
<button onclick="cmd('/mpd2/previous')">&lt;&lt; Prev</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button onclick="cmd('/mpd2/next')">Next &gt;&gt;</button><br>
<br>

Pause in <button onclick="cmd('/mpd2/fadePause5min')">5 min</button>&nbsp;&nbsp;
<button onclick="cmd('/mpd2/fadePause10min')">10 min</button><br>
<br>
</div>

<button onclick="cmd('/mpd/sync')">Sync</button><br><br>

<h2 id="titleMpd" onclick="toggle('mpd')">MPD Main</h2>
<div id="mpd">
<span id="mpdStatus">
<b>State:</b> <span id="mpdState"></span><br>
<b>Title:</b> <span id="mpdTitle"></span><br>
<b>Name:</b> <span id="mpdName"></span><br>
<div class="volume"><input type="range" min="1" max="100" value="50" class="slider" id="mpdVolume"></div>
</span><br>
<button onclick="cmd('/mpd/previous')">&lt;&lt; Prev</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button onclick="cmd('/mpd/next')">Next &gt;&gt;</button><br>
<br>

Pause in <button onclick="cmd('/mpd/fadePause5min')">5 min</button>&nbsp;&nbsp;
<button onclick="cmd('/mpd/fadePause10min')">10 min</button><br>
<br>
</div>

<h2 id="titleHoardLight" onclick="toggle('hoard-light')">Hoard Light</h2>

<button onclick="cmd('/hoard-light/toggle')">Toggle</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button onclick="cmd('/hoard-light/toggle5min')">Toggle 5min</button><br>
<br><br>

<h2 id="titleHoardFan" onclick="toggle('hoard-fan')">Hoard Fan</h2>

<button onclick="cmd('/hoard-fan/off15min')">On for 15min</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button onclick="cmd('/hoard-fan/off30min')">On for 30min</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button onclick="cmd('/hoard-fan/off60min')">On for 60min</button><br>
<br><br>

<h2 id="titleBlinds1">Main Blinds</h2>

<button onclick="cmd('/blinds1/up')">Up</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button onclick="cmd('/blinds1/down')">Down</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br><br>

<h2 id="titleAlarm" onclick="toggle('plug1')">Kompressor</h2>

<h2 id="titleMisc" onclick="toggleHide('misc', 'titleMisc')">Misc</h2>
<div id="misc" style="display:none">

<b>Allnet #1:</b>&nbsp;&nbsp;
<button onclick="cmd('/allnet1/on')">on</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button onclick="cmd('/allnet1/off')">off</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button onclick="cmd('/allnet1/status')">?</button><br>
<br>
<b>Allnet #2:</b>&nbsp;&nbsp;
<button onclick="cmd('/allnet1/on')">on</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button onclick="cmd('/allnet1/off')">off</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button onclick="cmd('/allnet1/status')">?</button><br>
<br><br>

<a href="http://grag.fritz.box:8081/">Domoticz</a><br>
<br>
<a href="https://grag.fritz.box:8443/">Unifi Controller</a><br>
<br><br>
<a href="http://grag-hoard-light.fritz.box">Grag Hoard Light</a><br>
<br>
<a href="http://grag-hoard-fan.fritz.box">Grag Hoard Fan</a><br>
<br>
<a href="http://grag-main-blinds.fritz.box">Grag Main Blinds</a><br>
<br>
<a href="http://grag-hoard-light.fritz.box">Grag Main Light</a><br>
<br>
<a href="http://grag-flur-light.fritz.box">Grag Flur Light</a><br>
<br>
<a href="http://grag-plug1.fritz.box">Grag Plug</a><br>
<br>
<a href="http://grag-container-flipdot.fritz.box">Grag Flipdot</a><br>
<br>
<a href="http://grag-container-light.fritz.box">Grag Container Light</a><br>
<br>

<textarea id="flipdot-text" rows="2" cols="20" maxlength="40">     Welcome to
       Clawtec</textarea><br>
<button onclick="cmd('/flipdot/f' + encodeURI(document.getElementById('flipdot-text').value))">Flipdot</button><br>
<br><br>

<textarea id="pos-text" rows="2" cols="20" maxlength="40">     Welcome to
       Clawtec</textarea><br>
<button onclick="cmd('/pos/f' + encodeURI(document.getElementById('pos-text').value))">POS</button><br>
<br><br>

Result: <span id="result"></span><br>
<br>

</div>

</body></html>
